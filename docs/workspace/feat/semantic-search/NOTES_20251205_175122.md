# NOTES_20251205_175122

## セマンティック検索機能の疎結合化の検討

セマンティック検索はオプショナル機能だが、現状はコアモジュールとの結合が強い。

現状の問題点:

- `query.py` に `SemanticContext` と `_setup_semantic_search` が直接存在
- `query.py` が `frontmatter_mcp.embedding` を import
- セマンティック検索を無効化しても、コード上の依存は残る

影響範囲:

| ファイル | 影響 |
|----------|------|
| `embedding.py` | 全削除可 |
| `embedding_cache.py` | 全削除可 |
| `embedding_indexer.py` | 全削除可 |
| `server.py` | 部分削除（グローバル変数、get_*関数、ツール定義） |
| `query.py` | 部分削除（SemanticContext、_setup_semantic_search） |

改善案:

`query.py` から semantic 関連を `semantic_query.py` に分離する。

```text
src/frontmatter_mcp/
├── query.py              # DuckDB クエリ実行のみ（semantic 非依存）
├── semantic_query.py     # SemanticContext + _setup_semantic_search
├── embedding.py
├── embedding_cache.py
├── embedding_indexer.py
└── server.py
```

`execute_query` は `conn_setup: Callable` を受け取る形に変更。server.py 側で `create_semantic_setup()` を呼び出す。

結論:

- パッケージ化（`semantic/`）は過剰
- ファイル分離で疎結合を実現可能
- 実装コストは低い
