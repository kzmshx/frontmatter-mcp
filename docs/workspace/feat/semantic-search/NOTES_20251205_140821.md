# NOTES_20251205_140821

## 追加の設計確認

### キャッシュディレクトリのパス

当初: `~/.cache/frontmatter-mcp/`

問題点:
- Windows では慣例と異なる
- プラットフォームごとに適切なパスが異なる（Linux: `~/.cache`, macOS: `~/Library/Caches`, Windows: `AppData/Local`）

検討した選択肢:
- platformdirs パッケージを使用 → 依存関係が増える
- 環境変数で上書き可能にする → ユーザー任せ
- `--base-dir` 配下に置く → シンプル、Vault ごとに分離

決定: `--base-dir/.frontmatter-mcp/` をデフォルトとし、`FRONTMATTER_CACHE_DIR` 環境変数で上書き可能にする

メリット:
- Vault ごとにキャッシュが分離される
- 環境変数やプラットフォーム差を気にしなくて良い
- Vault を移動してもキャッシュが一緒についてくる

### 起動時のインデキシング対象ファイル

既存の `collect_files(glob_pattern)` をそのまま使用。起動時は `collect_files("**/*.md")` で全 Markdown ファイルを取得する。

### index_refresh の重複呼び出し

既にインデキシング中の場合は何もせず現在の状態を返す。

```python
def index_refresh() -> dict:
    if _indexing:
        return {"message": "Indexing already in progress", "indexing": True}
    # インデキシング開始...
```

## クロスプラットフォーム対応

現状の実装は macOS 限定ではない。

確認した点:
- `pyproject.toml`: OS 制約なし
- `server.py`: `pathlib.Path` や標準ライブラリのみ使用
- 依存関係: すべてクロスプラットフォーム

セマンティック検索追加後も問題なし:
- sentence-transformers: クロスプラットフォーム
- DuckDB VSS 拡張: クロスプラットフォーム
- threading: Python 標準ライブラリ
