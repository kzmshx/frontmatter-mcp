# NOTES_20251205_190000

## base_dir を環境変数に移行 (破壊的変更)

`--base-dir` コマンドライン引数を廃止し、`FRONTMATTER_BASE_DIR` 環境変数に移行。
v0.2.1 で `--base-dir` 引数をリリース済みだが、v0.3.0 で破壊的変更としてリリースする。

理由:

- MCP プロトコルは stdio 経由で通信するため、環境変数の方が自然
- 他の設定 (`FRONTMATTER_ENABLE_SEMANTIC` 等) と統一される
- Claude Desktop の `claude_desktop_config.json` では `env` フィールドで環境変数を渡すのが標準的
- pydantic-settings との統合で追加の依存なしで実装可能

変更内容:

### settings.py

`base_dir` フィールドを追加:

```python
class Settings(BaseSettings):
    model_config = SettingsConfigDict(env_prefix="FRONTMATTER_")

    base_dir: Path | None = None  # NEW
    enable_semantic: bool = False
    embedding_model: str | None = None
    cache_dir: Path | None = None
```

### context.py

`set_base_dir()` 関数を削除し、`get_base_dir()` は `settings_module.settings.base_dir` を参照するように変更。

テストで `settings_module.settings` を差し替えられるよう、`from settings import settings` ではなく `import settings as settings_module` を使用。

### server.py

`main()` を大幅に簡素化:

```python
def main() -> None:
    """Entry point for the MCP server."""
    base_dir = get_base_dir()  # raises RuntimeError if not set
    if not base_dir.is_dir():
        raise RuntimeError(f"Base directory does not exist: {base_dir}")
    mcp.run()
```

`sys` と `set_base_dir` のインポートを削除。

### tests/test_server.py

`context_module.set_base_dir(base)` を `settings_module.Settings(base_dir=base)` に変更。

```python
# Set base_dir via settings
new_settings = settings_module.Settings(base_dir=base)
settings_module.settings = new_settings
```
